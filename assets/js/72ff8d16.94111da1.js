(self.webpackChunkweb=self.webpackChunkweb||[]).push([[9530],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),m=i,h=c["".concat(l,".").concat(m)]||c[m]||d[m]||o;return n?a.createElement(h,r(r({ref:t},u),{},{components:n})):a.createElement(h,r({ref:t},u))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},9944:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return u},default:function(){return c}});var a=n(2122),i=n(9756),o=(n(7294),n(3905)),r=["components"],s={title:"Basic Elements"},l=void 0,p={unversionedId:"language/basic-elements",id:"language/basic-elements",isDocsHomePage:!1,title:"Basic Elements",description:"App",source:"@site/docs/language/basic-elements.md",sourceDirName:"language",slug:"/language/basic-elements",permalink:"/docs/language/basic-elements",editUrl:"https://github.com/wasp-lang/wasp/edit/master/web/docs/language/basic-elements.md",version:"current",frontMatter:{title:"Basic Elements"},sidebar:"docs",previous:{title:"Overview",permalink:"/docs/language/overview"},next:{title:"CLI Reference",permalink:"/docs/cli"}},u=[{value:"App",id:"app",children:[]},{value:"Page",id:"page",children:[]},{value:"Route",id:"route",children:[{value:"Example - parametrised URL path",id:"example---parametrised-url-path",children:[]},{value:"Accessing route parameters in a page component",id:"accessing-route-parameters-in-a-page-component",children:[]},{value:"Navigating between routes",id:"navigating-between-routes",children:[]}]},{value:"Entity",id:"entity",children:[{value:"Using entities",id:"using-entities",children:[]}]},{value:"Queries and Actions (aka Operations)",id:"queries-and-actions-aka-operations",children:[{value:"Query",id:"query",children:[]},{value:"Action",id:"action",children:[]}]},{value:"Dependencies",id:"dependencies",children:[]},{value:"Authentication &amp; Authorization",id:"authentication--authorization",children:[{value:"Email and Password",id:"email-and-password",children:[]},{value:"<code>login()</code>",id:"login",children:[]},{value:"<code>signup()</code>",id:"signup",children:[]},{value:"<code>logout()</code>",id:"logout",children:[]},{value:"Updating user&#39;s password",id:"updating-users-password",children:[]},{value:"Accessing currently logged in user",id:"accessing-currently-logged-in-user",children:[]},{value:"<code>useAuth()</code>",id:"useauth",children:[]}]},{value:"Server configuration",id:"server-configuration",children:[{value:"setupFn",id:"setupfn",children:[]}]},{value:".env",id:"env",children:[]},{value:"Database",id:"database",children:[{value:"SQLite",id:"sqlite",children:[]},{value:"PostgreSQL",id:"postgresql",children:[]},{value:"Migrating from SQLite to PostgreSQL",id:"migrating-from-sqlite-to-postgresql",children:[]}]}],d={toc:u};function c(e){var t=e.components,n=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"app"},"App"),(0,o.kt)("p",null,"There can be only one ",(0,o.kt)("inlineCode",{parentName:"p"},"App")," element per Wasp project. It serves as a starting point and defines global\nproperties of your app. Currently, it is very simple:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},'app todoApp {\n    title: "ToDo App"\n}\n')),(0,o.kt)("h4",{id:"app-identifier"},(0,o.kt)("inlineCode",{parentName:"h4"},"app: identifier")),(0,o.kt)("p",null,"Name of your app."),(0,o.kt)("h4",{id:"title-string"},(0,o.kt)("inlineCode",{parentName:"h4"},"title: string")),(0,o.kt)("p",null,"Title of your app. It will be displayed in the browser tab, next to the favicon."),(0,o.kt)("h2",{id:"page"},"Page"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Page")," is the top-level layout abstraction. Your app can have multiple pages, and they are defined in Wasp\nas follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},'page Main {\n    component: import Main from "@ext/pages/Main",\n    authRequired: false // optional property\n}\n')),(0,o.kt)("h4",{id:"page-identifier"},(0,o.kt)("inlineCode",{parentName:"h4"},"page: identifier")),(0,o.kt)("p",null,"Name of the page."),(0,o.kt)("h4",{id:"component-js-import-statement"},(0,o.kt)("inlineCode",{parentName:"h4"},"component: js import statement")),(0,o.kt)("p",null,"Import statement of the page React element. See importing external code for details."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Page")," also has to be associated with a ",(0,o.kt)("inlineCode",{parentName:"p"},"Route"),", otherwise it won't be accessible in the app."),(0,o.kt)("h4",{id:"authrequired-bool"},(0,o.kt)("inlineCode",{parentName:"h4"},"authRequired: bool")),(0,o.kt)("p",null,"Optional property - can be specified only if ",(0,o.kt)("a",{parentName:"p",href:"/docs/language/basic-elements#authentication--authorization"},(0,o.kt)("inlineCode",{parentName:"a"},"auth"))," is declared. If set to ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),", only authenticated users will be able to access this page. Unauthenticated users will be redirected to a route declared by ",(0,o.kt)("inlineCode",{parentName:"p"},"onAuthFailedRedirectTo")," property within ",(0,o.kt)("inlineCode",{parentName:"p"},"auth"),"."),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"authRequired")," is set to ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),", the React component of a page (specified by ",(0,o.kt)("inlineCode",{parentName:"p"},"component")," property) will be provided ",(0,o.kt)("inlineCode",{parentName:"p"},"user")," object as a prop."),(0,o.kt)("p",null,"Check out this ",(0,o.kt)("a",{parentName:"p",href:"/docs/tutorials/todo-app/auth#updating-main-page-to-check-if-user-is-authenticated"},"section of our Todo app tutorial")," for an example of usage."),(0,o.kt)("h2",{id:"route"},"Route"),(0,o.kt)("p",null,"Using ",(0,o.kt)("inlineCode",{parentName:"p"},"Route")," element is a way to implement routing functionality in Wasp:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},'route "/about" -> page About\n')),(0,o.kt)("h4",{id:"route-string"},(0,o.kt)("inlineCode",{parentName:"h4"},"route: string")),(0,o.kt)("p",null,"URL path of the route. Route string can be parametrised and follows the same conventions as\n",(0,o.kt)("a",{parentName:"p",href:"https://reactrouter.com/web/"},"React Router"),"."),(0,o.kt)("h4",{id:"page-page-identifier"},(0,o.kt)("inlineCode",{parentName:"h4"},"page: page identifier")),(0,o.kt)("p",null,"Page identifier of the route's target. Referenced page must be defined somewhere in ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp")," file."),(0,o.kt)("h3",{id:"example---parametrised-url-path"},"Example - parametrised URL path"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},'route "/task/:id" -> page Task\n')),(0,o.kt)("p",null,"For details on URL path format check ",(0,o.kt)("a",{parentName:"p",href:"https://reactrouter.com/web/"},"React Router"),"\ndocumentation."),(0,o.kt)("h3",{id:"accessing-route-parameters-in-a-page-component"},"Accessing route parameters in a page component"),(0,o.kt)("p",null,"Since Wasp under the hood generates code with ",(0,o.kt)("a",{parentName:"p",href:"https://reactrouter.com/web/"},"React Router"),",\nthe same rules apply when accessing URL params in your React components. Here is an example just to get you\nstarted:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c",metastring:'title="todoApp.wasp"',title:'"todoApp.wasp"'},'// ...\nroute "/task/:id" -> page Task\npage Task {\n    component: import Task from "@ext/pages/Task"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="pages/Task.js"',title:'"pages/Task.js"'},"import React from 'react'\n\nconst Task = (props) => {\n  return (\n    <div>\n      I am showing a task with id: {props.match.params.id}.\n    </div>\n  )\n}\n\nexport default Task\n")),(0,o.kt)("h3",{id:"navigating-between-routes"},"Navigating between routes"),(0,o.kt)("p",null,"Navigation can be performed from the React code via ",(0,o.kt)("inlineCode",{parentName:"p"},"<Link/>")," component, also using the functionality of\n",(0,o.kt)("a",{parentName:"p",href:"https://reactrouter.com/web/"},"React Router"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c",metastring:'title="todoApp.wasp"',title:'"todoApp.wasp"'},'// ...\nroute "/home" -> page Home\npage Home {\n    component: import Home from "@ext/pages/Home"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="pages/OtherPage.js"',title:'"pages/OtherPage.js"'},'import React from \'react\'\nimport { Link } from "react-router-dom"\n\nconst OtherPage = (props) => {\n  return (\n    <Link to="/home">Go to homepage</Link>\n  )\n}\n')),(0,o.kt)("h2",{id:"entity"},"Entity"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Entity")," element represents a database model. Wasp uses ",(0,o.kt)("a",{parentName:"p",href:"https://www.prisma.io/"},"Prisma")," to implement\ndatabase functionality and currently provides only a thin layer above it."),(0,o.kt)("p",null,"Each ",(0,o.kt)("inlineCode",{parentName:"p"},"Entity")," element corresponds 1-to-1 to Prisma data model and is defined in a following way:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},"entity Task {=psl\n    id          Int     @id @default(autoincrement())\n    description String\n    isDone      Boolean @default(false)\npsl=}\n")),(0,o.kt)("h4",{id:"entity-identifier"},(0,o.kt)("inlineCode",{parentName:"h4"},"entity: identifier")),(0,o.kt)("p",null,"Name of the entity."),(0,o.kt)("h4",{id:"psl--psl-psl"},(0,o.kt)("inlineCode",{parentName:"h4"},"{=psl ... psl=}: PSL")),(0,o.kt)("p",null,"Definition of entity fields in ",(0,o.kt)("em",{parentName:"p"},"Prisma Schema Language")," (PSL). See\n",(0,o.kt)("a",{parentName:"p",href:"https://www.prisma.io/docs/reference/tools-and-interfaces/prisma-schema"},"here for intro and examples"),"\nand ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/prisma/specs/tree/master/schema"},"here for a more exhaustive language specification"),"."),(0,o.kt)("h3",{id:"using-entities"},"Using entities"),(0,o.kt)("p",null,"Entity-system in Wasp is based on ",(0,o.kt)("a",{parentName:"p",href:"http://www.prisma.io"},"Prisma"),", and currently Wasp provides only a thin layer\non top of it. The workflow is as follows:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Wasp developer creates/updates some of the entities in ",(0,o.kt)("inlineCode",{parentName:"li"},".wasp")," file."),(0,o.kt)("li",{parentName:"ol"},"Wasp developer runs ",(0,o.kt)("inlineCode",{parentName:"li"},"wasp db migrate-dev"),"."),(0,o.kt)("li",{parentName:"ol"},"Migration data is generated in ",(0,o.kt)("inlineCode",{parentName:"li"},"migrations/")," folder (and should be commited)."),(0,o.kt)("li",{parentName:"ol"},"Wasp developer uses Prisma JS API to work with the database when in Operations.")),(0,o.kt)("p",null,"Currently entities can be accessed only in Operations (Queries & Actions), so check their part of docs for more info on how to use entities in their context."),(0,o.kt)("h2",{id:"queries-and-actions-aka-operations"},"Queries and Actions (aka Operations)"),(0,o.kt)("p",null,"In Wasp, main interaction between client and server happens via Operations, of which two types exist: Queries and Actions."),(0,o.kt)("h3",{id:"query"},"Query"),(0,o.kt)("p",null,"Queries are NodeJS functions that don't modify any state. Normally they fetch certain resources, process them and return result. They are executed on server. "),(0,o.kt)("p",null,"To create a Wasp Query, we need two things: declaration in Wasp and implementation in NodeJS:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c",metastring:'title="main.wasp"',title:'"main.wasp"'},'// ...\nquery getTasks {\n  fn: import { getAllTasks } from "@ext/foo.js"\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="ext/foo.js"',title:'"ext/foo.js"'},'// ...\nexport getAllTasks = async (args, context) => {\n  return [\n    { description: "Buy some eggs", isDone: true },\n    { description: "Make an omelette", isDone: false }\n  ]\n}\n')),(0,o.kt)("p",null,"NodeJS function above has to be async and will be passed query arguments as first argument and additional context as second argument."),(0,o.kt)("p",null,"By declaring a NodeJS function as a Wasp query, following happens:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Wasp generates HTTP API route on the NodeJS server that calls the NodeJS query function."),(0,o.kt)("li",{parentName:"ul"},"Wasp generates JS function on the client that has the name under which query was declared and takes same arguments as the NodeJS query function. Internally it uses above mentioned HTTP API route to call the NodeJS query function.")),(0,o.kt)("p",null,"On client, you can import generated query JS function as ",(0,o.kt)("inlineCode",{parentName:"p"},"import getTasks from '@wasp/queries/getTasks.js'"),".\nThen, you can either use it directly, or you can use it via special ",(0,o.kt)("inlineCode",{parentName:"p"},"useQuery")," React hook (provided by Wasp**) to make it reactive."),(0,o.kt)("p",null,"On server, you can import it the same way as on client, and then you can call it directly."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"NOTE"),": Wasp will not stop you from importing NodeJS function directly on server, e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},'import { getAllTasks } from "./foo.js"'),", but you shouldn't do it, because it will import pure NodeJS function and not a query recognized by Wasp, so it will not get all the features of a Wasp query."),(0,o.kt)("h4",{id:"usequery"},"useQuery"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useQuery")," hook provided by Wasp is actually just a thin wrapper for ",(0,o.kt)("inlineCode",{parentName:"p"},"useQuery")," hook from ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tannerlinsley/react-query"},"react-query"),"."),(0,o.kt)("p",null,"You can import it as ",(0,o.kt)("inlineCode",{parentName:"p"},"import { useQuery } from '@wasp/queries'"),"."),(0,o.kt)("p",null,"Wasp ",(0,o.kt)("inlineCode",{parentName:"p"},"useQuery")," takes three args:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"queryFn"),": client query function generated by Wasp based on query declaration, e.g. one you get by importing in JS like this: ",(0,o.kt)("inlineCode",{parentName:"li"},"import getTasks from '@wasp/queries/getTasks.js'"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"queryFnArgs")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"config"),": react-query ",(0,o.kt)("inlineCode",{parentName:"li"},"config"),".")),(0,o.kt)("p",null,"It behaves exactly the same as ",(0,o.kt)("a",{parentName:"p",href:"https://react-query.tanstack.com/docs/api#usequery"},"useQuery from react-query"),", only it doesn't take the key, that is handled automatically instead."),(0,o.kt)("p",null,"Example of usage:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import React from 'react'\nimport { useQuery } from '@wasp/queries'\nimport getTasks from '@wasp/queries/getTasks'\n\nconst MyComponent = (props) => {\n  const { data: tasks, error } = useQuery(getTasks)\n  return <div> { JSON.stringify(tasks || error) } </div>\n}\n")),(0,o.kt)("h4",{id:"error-handling"},"Error handling"),(0,o.kt)("p",null,"For security reasons, all errors thrown in the query NodeJS function are sent to the client via HTTP API as 500 errors, with any further details removed, so that any unpredicted errors don't make it out with possibly sensitive data."),(0,o.kt)("p",null,"If you do want to throw an error that will pass some information to the client, you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpError")," in your NodeJS query function:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import HttpError from '@wasp/core/HttpError.js'\n\nexport getTasks = async (args, context) => {\n  const statusCode = 403\n  const message = 'You can\\'t do this!'.\n  const data = { foo: 'bar' }\n  throw new HttpError(statusCode, message, data)\n}\n")),(0,o.kt)("p",null,"and then in client it will be thrown as an Error with corresponding ",(0,o.kt)("inlineCode",{parentName:"p"},".message")," and ",(0,o.kt)("inlineCode",{parentName:"p"},".data")," fields (if status code is 4xx - otherwise ",(0,o.kt)("inlineCode",{parentName:"p"},"message")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"data")," will not be forwarded to the client, for security reasons)."),(0,o.kt)("p",null,"This ensures that no error will accidentally leak out from the server, potentionally exposing sensitive data or implementation details."),(0,o.kt)("h4",{id:"using-entities-1"},"Using entities"),(0,o.kt)("p",null,"Most often, resources used by Operations will be Entities."),(0,o.kt)("p",null,"To use an Entity in your Operation, declare in Wasp that Operation uses it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c",metastring:'{4} title="todoApp.wasp"',"{4}":!0,title:'"todoApp.wasp"'},'// ...\nquery getTasks {\n  fn: import { getAllTasks } from "@ext/foo.js",\n  entities: [Task]\n}\n')),(0,o.kt)("p",null,"This will inject specified entity into the context of your Operation.\nNow, you can access Prisma API for that entity like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="ext/foo.js"',title:'"ext/foo.js"'},"// ...\nexport getAllTasks = async (args, context) => {\n  return context.entities.Task.findMany({})\n}\n")),(0,o.kt)("p",null,"where ",(0,o.kt)("inlineCode",{parentName:"p"},"context.entities.Task")," actually exposes ",(0,o.kt)("inlineCode",{parentName:"p"},"prisma.task")," from ",(0,o.kt)("a",{parentName:"p",href:"https://www.prisma.io/docs/reference/tools-and-interfaces/prisma-client/crud"},"Prisma API"),"."),(0,o.kt)("h4",{id:"cache-invalidation"},"Cache invalidation"),(0,o.kt)("p",null,"One of the trickiest part of managing web app state is making sure that data which queries are showing is up to date."),(0,o.kt)("p",null,"Since Wasp is using react-query for managing queries, that means we want to make sure that parts of react-query cache are invalidated when we know they are not up to date any more."),(0,o.kt)("p",null,"This can be done manually, by using mechanisms provided by react-query (refetch, direct invalidation).\nHowever, that can often be tricky and error-prone, so Wasp offers quick and effective solution to get you started: automatic invalidation of query cache based on entities that queries / actions are using."),(0,o.kt)("p",null,"Specifically, if Action A1 uses Entity E1 and Query Q1 also uses Entity E1 and Action A1 is executed, Wasp will recognize that Q1 might not be up-to-date any more and will therefore invalidate its cache, making sure it gets updated."),(0,o.kt)("p",null,"In practice, this means that without really even thinking about it, Wasp will make sure to keep the queries up to date for you in regard with the changes done by actions."),(0,o.kt)("p",null,"On the other hand, this kind of automatic invalidation of cache can be wasteful (updating when not needed) and will not work if other resources than entities are used. In that case, make sure to use mechanisms provided by react-query for now, and expect more direct support in Wasp for handling those use cases in a nice, elegant way."),(0,o.kt)("h3",{id:"action"},"Action"),(0,o.kt)("p",null,"Actions are very similar to Queries, so similar that we will only list the differences:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"They can modify state (queries can't)."),(0,o.kt)("li",{parentName:"ol"},"There is no special React hook for them (like ",(0,o.kt)("inlineCode",{parentName:"li"},"useQuery")," for Queries), you just call them directly."),(0,o.kt)("li",{parentName:"ol"},"They are declared in Wasp in same way as Queries, but keyword is ",(0,o.kt)("inlineCode",{parentName:"li"},"action"),", not ",(0,o.kt)("inlineCode",{parentName:"li"},"query"),".")),(0,o.kt)("p",null,"More differences and action/query specific features will come in the future versions of Wasp."),(0,o.kt)("h2",{id:"dependencies"},"Dependencies"),(0,o.kt)("p",null,"You can specify additional npm dependencies in following way, in your ",(0,o.kt)("inlineCode",{parentName:"p"},"*.wasp")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'dependencies {=json\n  "redux": "^4.0.5",\n  "react-redux": "^7.1.3"\njson=}\n')),(0,o.kt)("p",null,"You will need to re-run ",(0,o.kt)("inlineCode",{parentName:"p"},"wasp start")," after adding a dependency for Wasp to pick it up."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"NOTE"),": In current implementation of Wasp, if Wasp is already internally using certain npm dependency with certain version specified, you are not allowed to define that same npm dependency yourself while specifying different version.\nIf you do that, you will get an error message telling you which exact version you have to use for that dependency.\nThis means Wasp dictates exact versions of certain packages, so for example you can't choose version of React you want to use.\nIn the future, we will add support for picking any version you like, but we have not implemented that yet. Check ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wasp-lang/wasp/issues/59"},"issue #59")," to check out the progress or contribute."),(0,o.kt)("h2",{id:"authentication--authorization"},"Authentication & Authorization"),(0,o.kt)("p",null,"Wasp provides authentication and authorization support out-of-the-box. Enabling it for your app is optional and can be done by adding ",(0,o.kt)("inlineCode",{parentName:"p"},"auth")," element to your ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},'auth {\n    userEntity: User,\n    methods: [ EmailAndPassword ],\n    onAuthFailedRedirectTo: "/someRoute"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"userEntity: entity"),"\nEntity which represents the user (sometimes also referred to as ",(0,o.kt)("em",{parentName:"p"},"Principal"),")."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"methods: [AuthMethod]"),"\nList of authentication methods that Wasp app supports. Currently supported methods are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"EmailAndPassword"),": Provides support for authentication with email address and a password.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"onAuthFailedRedirectTo: String")," Name of the route where an unauthenticated user will be redirected to if they try to access a private page (which is declared by setting ",(0,o.kt)("inlineCode",{parentName:"p"},"authRequired: true")," for a specific page).\nCheck out this ",(0,o.kt)("a",{parentName:"p",href:"/docs/tutorials/todo-app/auth#updating-main-page-to-check-if-user-is-authenticated"},"section of our Todo app tutorial")," to see an example of usage."),(0,o.kt)("h3",{id:"email-and-password"},"Email and Password"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"EmailAndPassword")," authentication method makes it possible to signup/login into the app by using email address and a password.\nThis method requires that ",(0,o.kt)("inlineCode",{parentName:"p"},"userEntity")," specified in ",(0,o.kt)("inlineCode",{parentName:"p"},"auth")," element contains ",(0,o.kt)("inlineCode",{parentName:"p"},"email: string")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"password: string")," fields."),(0,o.kt)("h4",{id:"high-level-api"},"High-level API"),(0,o.kt)("p",null,"The quickest way to get started is by using the following API generated by Wasp:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Signup and Login forms at ",(0,o.kt)("inlineCode",{parentName:"li"},"@wasp/auth/forms/Signup")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"@wasp/auth/forms/Login")," routes"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"logout")," function"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"useAuth()")," React hook")),(0,o.kt)("p",null,"Check our ",(0,o.kt)("a",{parentName:"p",href:"/docs/tutorials/todo-app/auth"},"Todo app tutorial")," to see how it works. See below for detailed specification of each of these methods."),(0,o.kt)("h4",{id:"lower-level-api"},"Lower-level API"),(0,o.kt)("p",null,"If you require more control in your authentication flow, you can achieve that in the following ways:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If you don't want to use already generated Signup and Login forms and want to create your own, you can use ",(0,o.kt)("inlineCode",{parentName:"li"},"signup")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"login")," function by invoking them from the client."),(0,o.kt)("li",{parentName:"ul"},"If you want to execute custom code on the server during sign up, create your own sign up action which invokes Prisma client as ",(0,o.kt)("inlineCode",{parentName:"li"},"context.entities.[USER_ENTITY].create()")," function, along with your custom code.")),(0,o.kt)("p",null,"The code of your custom sign-up action would look like this (your user entity being ",(0,o.kt)("inlineCode",{parentName:"p"},"User")," in this instance):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export const signUp = async (args, context) => {\n    // Your custom code before sign-up.\n    // ...\n    const newUser = context.entities.User.create({\n        data: { email: 'some@email.com', password: 'this will be hashed!' } \n    })\n\n    // Your custom code after sign-up.\n    // ...\n    return newUser\n}\n")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You don't need to worry about hashing the password yourself! Even when you are using Prisma's client directly and calling ",(0,o.kt)("inlineCode",{parentName:"p"},"create()")," with a plain-text password, Wasp put middleware in place that takes care of hashing it before storing it to the database."))),(0,o.kt)("h4",{id:"specification"},"Specification"),(0,o.kt)("h3",{id:"login"},(0,o.kt)("inlineCode",{parentName:"h3"},"login()")),(0,o.kt)("p",null,"An action for logging in the user."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"login(email, password)\n")),(0,o.kt)("h4",{id:"email-string"},(0,o.kt)("inlineCode",{parentName:"h4"},"email: string")),(0,o.kt)("p",null,"Email of the user logging in."),(0,o.kt)("h4",{id:"password-string"},(0,o.kt)("inlineCode",{parentName:"h4"},"password: string")),(0,o.kt)("p",null,"Password of the user logging in."),(0,o.kt)("h4",{id:"import-statement"},(0,o.kt)("inlineCode",{parentName:"h4"},"import statement"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import login from '@wasp/auth/login.js'\n")),(0,o.kt)("p",null,"Login is a regular action and can be used directly from the frontend."),(0,o.kt)("h3",{id:"signup"},(0,o.kt)("inlineCode",{parentName:"h3"},"signup()")),(0,o.kt)("p",null,"An action for signing in in the user."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"signup(userFields)\n")),(0,o.kt)("h4",{id:"userfields-object"},(0,o.kt)("inlineCode",{parentName:"h4"},"userFields: object")),(0,o.kt)("p",null,"Fields of user entity which was declared in ",(0,o.kt)("inlineCode",{parentName:"p"},"auth"),"."),(0,o.kt)("h4",{id:"import-statement-1"},(0,o.kt)("inlineCode",{parentName:"h4"},"import statement"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import signup from '@wasp/auth/signup.js'\n")),(0,o.kt)("p",null,"Signup is a regular action and can be used directly from the frontend."),(0,o.kt)("h3",{id:"logout"},(0,o.kt)("inlineCode",{parentName:"h3"},"logout()")),(0,o.kt)("p",null,"An action for logging out the user."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"logout()\n")),(0,o.kt)("h4",{id:"import-statement-2"},(0,o.kt)("inlineCode",{parentName:"h4"},"import statement"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import logout from '@wasp/auth/logout.js'\n")),(0,o.kt)("h5",{id:"example-of-usage"},"Example of usage:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import logout from '@wasp/auth/logout.js'\n\nconst SignOut = () => {\n  return (\n    <button onClick={logout}>Logout</button>\n  )\n}\n")),(0,o.kt)("h4",{id:"reset-password"},"Reset password"),(0,o.kt)("p",null,"Coming soon."),(0,o.kt)("h3",{id:"updating-users-password"},"Updating user's password"),(0,o.kt)("p",null,"If you need to update user's password, you can do it safely via Prisma client, e.g. within an action:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export const updatePassword = async (args, context) => {\n  return context.entities.User.update({\n    where: { id: args.userId },\n    data: {\n      password: 'New pwd which will be hashed automatically!'\n    }\n  })\n}\n")),(0,o.kt)("p",null,"You don't need to worry about hashing the password yourself - if you have an ",(0,o.kt)("inlineCode",{parentName:"p"},"auth")," declaration\nin your ",(0,o.kt)("inlineCode",{parentName:"p"},".wasp")," file, Wasp already set a middleware on Prisma that makes sure whenever password\nis created or updated on the user entity, it is also hashed before it is stored to the database."),(0,o.kt)("h3",{id:"accessing-currently-logged-in-user"},"Accessing currently logged in user"),(0,o.kt)("p",null,"When authentication is enabled in a Wasp app, we need a way to tell whether a user is logged in and access its data.\nWith that, we can further implement access control and decide which content is private and which public."),(0,o.kt)("h4",{id:"on-client"},"On client"),(0,o.kt)("p",null,"On client, Wasp provides ",(0,o.kt)("inlineCode",{parentName:"p"},"useAuth")," React hook to be used within the functional components.\n",(0,o.kt)("inlineCode",{parentName:"p"},"useAuth")," is actually a thin wrapper over Wasp's ",(0,o.kt)("inlineCode",{parentName:"p"},"useQuery")," hook and returns data in the exactly same\nformat."),(0,o.kt)("h3",{id:"useauth"},(0,o.kt)("inlineCode",{parentName:"h3"},"useAuth()")),(0,o.kt)("h4",{id:"import-statement-3"},(0,o.kt)("inlineCode",{parentName:"h4"},"import statement"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import useAuth from '@wasp/auth/useAuth.js'\n")),(0,o.kt)("h5",{id:"example-of-usage-1"},"Example of usage:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="ext/MainPage.js"',title:'"ext/MainPage.js"'},"import React from 'react'\n\nimport { Link } from 'react-router-dom'\nimport useAuth from '@wasp/auth/useAuth.js'\nimport logout from '@wasp/auth/logout.js'\nimport Todo from '../Todo.js'\nimport '../Main.css'\n\nconst Main = () => {\n  const { data: user } = useAuth()\n\n  if (!user) {\n    return (\n      <span>\n        Please <Link to='/login'>login</Link> or <Link to='/signup'>sign up</Link>.\n      </span>\n    )\n  } else {\n    return (\n      <>\n        <button onClick={logout}>Logout</button>\n        <Todo />\n      < />\n    )\n  }\n}\n\nexport default Main\n")),(0,o.kt)("h4",{id:"on-server"},"On server"),(0,o.kt)("p",null,"When authentication is enabled, all the operations (actions and queries) will have ",(0,o.kt)("inlineCode",{parentName:"p"},"user")," object\npresent in the ",(0,o.kt)("inlineCode",{parentName:"p"},"context")," argument. ",(0,o.kt)("inlineCode",{parentName:"p"},"context.user")," will contain all the fields from the user entity\nexcept for the password."),(0,o.kt)("h5",{id:"example-of-usage-2"},"Example of usage:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="ext/actions.js"',title:'"ext/actions.js"'},"import HttpError from '@wasp/core/HttpError.js'\n\nexport const createTask = async (task, context) => {\n  if (!context.user) {\n    throw new HttpError(403)\n  }\n\n  const Task = context.entities.Task\n  return Task.create({\n    data: {\n      description: task.description,\n      user: {\n        connect: { id: context.user.id }\n      }\n    }\n  })\n}\n")),(0,o.kt)("p",null,"In order to implement access control, each operation is responsible for checking ",(0,o.kt)("inlineCode",{parentName:"p"},"context.user")," and\nacting accordingly - e.g. if ",(0,o.kt)("inlineCode",{parentName:"p"},"context.user")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"undefined")," and the operation is private then user\nshould be denied access to it."),(0,o.kt)("h2",{id:"server-configuration"},"Server configuration"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},"server {\n  ...\n}\n")),(0,o.kt)("p",null,"With ",(0,o.kt)("inlineCode",{parentName:"p"},"server")," declaration, you can configure behaviour of the Node.js server (one that is executing wasp operations)."),(0,o.kt)("p",null,"Currently ",(0,o.kt)("inlineCode",{parentName:"p"},"server")," supports only one option, ",(0,o.kt)("inlineCode",{parentName:"p"},"setupFn"),", but there will likely be more options added in the future."),(0,o.kt)("h3",{id:"setupfn"},"setupFn"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},'server {\n  setupFn: import mySetupFunction from "@ext/myServerSetupCode.js"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"setupFn")," declares a JS function that will be executed on server start. This function is expected to be async and will be awaited before server continues with its setup and starts serving any requests."),(0,o.kt)("p",null,"It gives you an opportunity to do any custom setup, e.g. setting up additional database or starting cron/scheduled jobs."),(0,o.kt)("p",null,"The javascript function should be async, takes no arguments and its return value is ignored."),(0,o.kt)("p",null,"In case you want to store some values for later use, or to be accessed by the Operations, recommended way is to store those in variables in the same module/file where you defined the javascript setup function and then expose additional functions for reading those values, which you can then import directly from Operations and use. This effectively turns your module into a singleton whose construction is performed on server start."),(0,o.kt)("p",null,"Dummy example of such function and its usage:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="ext/myServerSetupCode.js"',title:'"ext/myServerSetupCode.js"'},"let someResource = undefined\n\nconst mySetupFunction = async () => {\n  // Let's pretend functions setUpSomeResource and startSomeCronJob\n  // are implemented below or imported from another file.\n  someResource = await setUpSomeResource()\n  startSomeCronJob()\n}\n\nexport const getSomeResource = () => someResource\n\nexport default mySetupFunction\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="ext/queries.js"',title:'"ext/queries.js"'},"import { getSomeResource } from './myServerSetupCode.js'\n\n...\n\nexport const someQuery = async (args, context) => {\n  const someResource = getSomeResource()\n  return queryDataFromSomeResource(args, someResource)\n}\n")),(0,o.kt)("h2",{id:"env"},".env"),(0,o.kt)("p",null,"Your project will likely be using environment variables for configuration, typically to define connection to the database, API keys for external services and similar."),(0,o.kt)("p",null,"When in production, you will typically define environment variables through mechanisms provided by your hosting provider."),(0,o.kt)("p",null,'However, when in development, you might also need to supply certain environment variables, and to avoid doing it "manually", Wasp supports ',(0,o.kt)("inlineCode",{parentName:"p"},".env")," (dotenv) file where you can define environment variables that will be used during development (they will not be used during production)."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},".env")," file has to be defined in the root of your Wasp project."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},".env")," file should not be commited to the version control - we already ignore it by default in the .gitignore file we generate when you create a new Wasp project via ",(0,o.kt)("inlineCode",{parentName:"p"},"wasp new")," cli command."),(0,o.kt)("p",null,"Variables are defined in ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," in the form of ",(0,o.kt)("inlineCode",{parentName:"p"},"NAME=VALUE"),", for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"DATABASE_URL=postgresql://localhost:5432\nMY_VAR=somevalue\n")),(0,o.kt)("p",null,"Any env vars defined in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," will be forwarded to the server-side of your Wasp project and therefore accessible in your nodejs code via ",(0,o.kt)("inlineCode",{parentName:"p"},"process.env"),", for example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"console.log(process.env.DATABASE_URL)\n")),(0,o.kt)("h2",{id:"database"},"Database"),(0,o.kt)("p",null,"You can specify database to be used by Wasp via ",(0,o.kt)("inlineCode",{parentName:"p"},"db")," element (there can be only one such element per Wasp project):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-css"},"db {\n  system: PostgreSQL\n}\n")),(0,o.kt)("p",null,"If you don't have ",(0,o.kt)("inlineCode",{parentName:"p"},"db")," block, default database is used (which is ",(0,o.kt)("inlineCode",{parentName:"p"},"SQLite"),")."),(0,o.kt)("p",null,"If you create or modify ",(0,o.kt)("inlineCode",{parentName:"p"},"db")," declaration, run ",(0,o.kt)("inlineCode",{parentName:"p"},"wasp db migrate-dev")," to apply the changes."),(0,o.kt)("h4",{id:"system-identifier"},(0,o.kt)("inlineCode",{parentName:"h4"},"system: identifier")),(0,o.kt)("p",null,"Database system that Wasp will use. It can be either ",(0,o.kt)("inlineCode",{parentName:"p"},"PostgreSQL")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"SQLite"),"."),(0,o.kt)("h3",{id:"sqlite"},"SQLite"),(0,o.kt)("p",null,"Default database is ",(0,o.kt)("inlineCode",{parentName:"p"},"SQLite"),", since it is great for getting started with a new project (needs no configuring), but it can be used only in development - once you want to deploy Wasp to production you will need to switch to ",(0,o.kt)("inlineCode",{parentName:"p"},"PostgreSQL")," and stick with it.\nCheck below for more details on how to migrate from SQLite to PostgreSQL."),(0,o.kt)("h3",{id:"postgresql"},"PostgreSQL"),(0,o.kt)("p",null,"When using ",(0,o.kt)("inlineCode",{parentName:"p"},"PostgreSQL")," (",(0,o.kt)("inlineCode",{parentName:"p"},"db { system: PostgreSQL }"),"), you will need to spin up a postgres database on your own so it runs during development (when running ",(0,o.kt)("inlineCode",{parentName:"p"},"wasp start")," or doing ",(0,o.kt)("inlineCode",{parentName:"p"},"wasp db ...")," commands) and provide Wasp with ",(0,o.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," environment variable that Wasp will use to connect to it."),(0,o.kt)("p",null,"One of the easiest ways to do this is by spinning up postgres docker container when you need it with the shell command"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker run \\\n  --rm \\\n  --publish 5432:5432 \\\n  -v postgresql-data:/var/lib/postgresql/data \\\n  --env POSTGRES_PASSWORD=devpass \\\n  postgres\n")),(0,o.kt)("p",null,"and adding the line"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"DATABASE_URL=postgresql://postgres:devpass@localhost:5432/postgres\n")),(0,o.kt)("p",null,"to the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file in the root directory of your Wasp project."),(0,o.kt)("h3",{id:"migrating-from-sqlite-to-postgresql"},"Migrating from SQLite to PostgreSQL"),(0,o.kt)("p",null,"To run Wasp app in production, you will need to switch from ",(0,o.kt)("inlineCode",{parentName:"p"},"SQLite")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"PostgreSQL"),"."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Set ",(0,o.kt)("inlineCode",{parentName:"li"},"db.system")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"PostgreSQL")," and set ",(0,o.kt)("inlineCode",{parentName:"li"},"DATABASE_URL")," env var accordingly (as described ",(0,o.kt)("a",{parentName:"li",href:"/docs/language/basic-elements#postgresql"},"above"),")."),(0,o.kt)("li",{parentName:"ol"},"Delete old migrations, since they are SQLite migrations and can't be used with PostgreSQL: ",(0,o.kt)("inlineCode",{parentName:"li"},"rm -r migrations/"),"."),(0,o.kt)("li",{parentName:"ol"},"Run ",(0,o.kt)("inlineCode",{parentName:"li"},"wasp db migrate-dev")," to apply new changes and create new, initial migration. You will need to have your postgres database running while doing this (check ",(0,o.kt)("a",{parentName:"li",href:"/docs/language/basic-elements#postgresql"},"above")," for easy way to get it running).")))}c.isMDXComponent=!0}}]);